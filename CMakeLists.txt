cmake_minimum_required(VERSION 3.20)
project(SpotifyAPILib VERSION 0.1 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)



# --- Library ---
add_library(SpotifyAPILib STATIC
        src/auth/Auth.cpp
        src/auth/AuthServer.cpp
        src/core/Client.cpp
        src/util/Http.cpp
        src/util/Tools.cpp
        src/util/JsonMapping.cpp
        src/api/BaseAPI.cpp
        src/api/AlbumAPI.cpp
        src/api/ArtistAPI.cpp
        src/api/AudiobookAPI.cpp
        src/api/PlayerAPI.cpp

)

# Public includes: SpotifyAPILib
target_include_directories(SpotifyAPILib PUBLIC include)

# Private include: Thirdparty
target_include_directories(SpotifyAPILib PUBLIC thirdparty)

# --- Dependencies ---
find_package(CURL REQUIRED)
find_package(Threads REQUIRED)

target_link_libraries(SpotifyAPILib PRIVATE
        CURL::libcurl
        Threads::Threads
)


# --- Examples ---
# --- Helper to put binaries in the right subfolder ---
function(set_example_output_dir TARGET_NAME SUBFOLDER)
    set_target_properties(${TARGET_NAME} PROPERTIES
            RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/examples/${SUBFOLDER}"
    )
    # Handle Multi-config (Debug/Release folders) for macOS/Windows
    foreach(CONFIG ${CMAKE_CONFIGURATION_TYPES})
        string(TOUPPER ${CONFIG} CONFIG_UPPER)
        set_target_properties(${TARGET_NAME} PROPERTIES
                RUNTIME_OUTPUT_DIRECTORY_${CONFIG_UPPER} "${CMAKE_BINARY_DIR}/examples/${SUBFOLDER}"
        )
    endforeach()
endfunction()

# --- Auth Examples ---
add_executable(example_authManual examples/auth/authManualExample.cpp)
target_link_libraries(example_authManual PRIVATE SpotifyAPILib)
set_example_output_dir(example_authManual "auth")

add_executable(example_authServer examples/auth/authServerExample.cpp)
target_link_libraries(example_authServer PRIVATE SpotifyAPILib)
set_example_output_dir(example_authServer "auth")

#Copy the HTML file to the same folder as the binaries
configure_file(
        "${CMAKE_CURRENT_SOURCE_DIR}/examples/auth/index.html"
        "${CMAKE_BINARY_DIR}/examples/auth/index.html"
        COPYONLY
)


# --- Player Data Examples ---
add_executable(example_playerCurrent examples/player/currentTrackExample.cpp)
target_link_libraries(example_playerCurrent PRIVATE SpotifyAPILib)
set_example_output_dir(example_playerCurrent "player")

add_executable(example_playback examples/player/playbackExample.cpp)
target_link_libraries(example_playback PRIVATE SpotifyAPILib)
set_example_output_dir(example_playback "player")


# --- Album Examples ---
add_executable(example_newReleases examples/albums/newReleaseExample.cpp)
target_link_libraries(example_newReleases PRIVATE SpotifyAPILib)
set_example_output_dir(example_newReleases "albums")

add_executable(example_getAlbums examples/albums/getAlbumExample.cpp)
target_link_libraries(example_getAlbums PRIVATE SpotifyAPILib)
set_example_output_dir(example_getAlbums "albums")

add_executable(example_getAlbumTracks examples/albums/getAlbumTracksExample.cpp)
target_link_libraries(example_getAlbumTracks PRIVATE SpotifyAPILib)
set_example_output_dir(example_getAlbumTracks "albums")

add_executable(example_getUserAlbums examples/albums/getUserAlbumsExample.cpp)
target_link_libraries(example_getUserAlbums PRIVATE SpotifyAPILib)
set_example_output_dir(example_getUserAlbums "albums")

add_executable(example_saveUserAlbums examples/albums/saveAlbumForUserExample.cpp)
target_link_libraries(example_saveUserAlbums PRIVATE SpotifyAPILib)
set_example_output_dir(example_saveUserAlbums "albums")

add_executable(example_deleteUserAlbums examples/albums/removeAlbumForUserExample.cpp)
target_link_libraries(example_deleteUserAlbums PRIVATE SpotifyAPILib)
set_example_output_dir(example_deleteUserAlbums "albums")


# --- Artist Examples ---
add_executable(example_getArtists examples/artists/getArtistExample.cpp)
target_link_libraries(example_getArtists PRIVATE SpotifyAPILib)
set_example_output_dir(example_getArtists "artists")

add_executable(example_getArtistsAlbums examples/artists/getArtistsAlbumsExample.cpp)
target_link_libraries(example_getArtistsAlbums PRIVATE SpotifyAPILib)
set_example_output_dir(example_getArtistsAlbums "artists")

add_executable(example_getArtistTopTracks examples/artists/getArtistTopTracksExample.cpp)
target_link_libraries(example_getArtistTopTracks PRIVATE SpotifyAPILib)
set_example_output_dir(example_getArtistTopTracks "artists")